:: generated from ament_package/template/prefix_level/setup.bat.in
@echo off

if defined AMENT_TRACE_SETUP_FILES echo Inside %~0

:: set the same directory as this file
set "AMENT_CURRENT_PREFIX=%~dp0"

:: set type of shell if not already set
if not defined AMENT_SHELL (
  set "AMENT_SHELL=bat"
)

:: find parent prefix path files for all packages under the current prefix
call:list_files_sorted _RESOURCES "%AMENT_CURRENT_PREFIX%\share\ament_index\resource_index\parent_prefix_path"

if "%_RESOURCES%" NEQ "" (
  for %%a in ("%_RESOURCES:;=";"%") do (
    echo To do: call local setup files for the parent workspaces listed in "%%~a"
  }
}

echo To do: call local setup files for this workspace

:: prevent second eval of functions below
if defined AMENT_TRACE_SETUP_FILES echo Leaving %~0
goto:eof

:: function to list the files in a directory in numerical order
:: http://stackoverflow.com/a/18749126
:list_files_sorted
  setlocal enabledelayedexpansion
  :: create an array with filenames in right order
  for /f %%f in ('dir /b "%~2"') do (
     for /F "delims=-" %%n in ("%%f") do (
        set "number=00000%%n"
        set "file[!number:~-6!]=%%f"
     )
  )
  :: process the filenames in right order
  set "_files="
  for /F "tokens=2 delims==" %%f in ('set file[') do (
    if "%_files%" NEQ "" set "_files=%_files%;"
    set "_files=%_files%%f%"
  )
  :: return result by reference
  (endlocal
    set "%~1=%_files%")
goto:eof
